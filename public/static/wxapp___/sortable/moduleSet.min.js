$.fn.moduleSet = function(opt) {
    var setting = {
        button: [{
            text: "编辑",
            callback: function() {},
            iconfont: "&#xe648;"
        },
        {
            text: "美化",
            callback: function() {},
            iconfont: "&#xe63f;"
        },
        {
            text: "删除",
            callback: function() {},
            iconfont: "&#xe613;"
        },
        ],
    };
    var options = $.extend({},
    setting, opt);
    var M = {};
    var _this = this; 
    M.init = function() {
        $(_this).css("position", "relative");
        M.createStyle();
        M.createElem(function() {
            M.initShowModule()
        })
    };
    M.initShowModule = function() {
        $(_this).mouseenter(function() {
            $(_this).find(".panel-module-box").fadeIn(200)
        }).mouseleave(function() {
            $(_this).find(".panel-module-box").fadeOut(100)
        })
    };
    M.createStyle = function() {
        if ($("#panel-style").length > 0) {
            return
        }
        var style = '<style id="panel-style">.panel-module-box{display:none;}.panel-module-mask{ position: absolute; z-index: 1; left: 0; right: 0; bottom: 0; top: 0; background: #fff; opacity: .7; border: 2px dashed #fff; cursor: move; } .panel-module-handle{ position: absolute; left:0; top:0; z-index: 2; } .handle-btn{ cursor: pointer; padding:7px 20px; border:1px solid #eee; background-color: #fff; border-right:0; } .handle-btn:hover{ background-color: #f1f3f5; } .handle-btn:last-child{ border-right:1px solid #eee; }</style>';
        $($("head")[0]).append(style)
    };
    M.createElem = function(callback) {
        if ($(_this).find(".panel-module-handle").length > 0) {
            return
        }
        var btnGroup = "";
        for (var i = 0; i < options.button.length; i++) {
            btnGroup += '<button class="handle-btn"><i class="iconfont">' + options.button[i].iconfont + "</i>" + options.button[i].text + "</button>";
            M.createEvent(i)
        }
        var elem = '<div class="panel-module-box"><div class="panel-module-mask"></div><div class="panel-module-handle">' + btnGroup + "</div></div>";
        $(_this).append(elem);
        callback && typeof(callback) == "function" && callback(this)
    };
    M.createEvent = function(index) {
        $(_this).delegate("button:eq(" + index + ")", "click",
        function() { !! options.button[index].callback && typeof(options.button[index].callback) == "function" && options.button[index].callback(this)
        })
    };
    M.init()
};